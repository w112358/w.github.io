<!DocTYPE HTML>
<html>

  <head>
    <meta charset="utf-8" />
    <title>Poke</title>
    <style>

/*    body{
      margin: 0;
      background-color: black;
      background-image: url("img/b1.jpg");
      background-attachment: fixed;
    }
*/

    </style>
  </head>

  <body>

    <svg id="mysvg">
      <svg id="first"></svg>
    </svg>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="d3-scale-radial.js"></script>

    <script>

  /*  d3.queue()
      .defer(d3.csv, "Pokemon_less.csv")
      .defer(d3.csv, "poke_type.csv")
      .awaitAll(function(error, data){
        if(error)throw(error);

        var pokes = data[0];
        var types = data[1];

        pokes.forEach(function(d){
          for(var j in d){
            var num = + d[j];
            if(isNaN(num) == false){
              d[j] = num;
            }
          }
        })
        types.forEach(function(d){
          for(var j in d){
            var num = +d[j];
            if(isNaN(num) == false){
              d[j] = num;
            }
          }
        })
        return pokes, types;
      })
      */
    var margin = 200;
    var mysvg = d3.select("#mysvg")
                  .attr("width", window.innerWidth - 2*margin)
                  .attr("height", window.innerHeight- 2*margin)
                  .style("background-color", "black")
                  .attr("opacity", "1")
                  .attr("transform", "translate(" + margin + ", " + margin + ")");



    var first = d3.select("#first")
                .attr("width", "900")
                .attr("height", "900")
                .attr("transform", "translate("+ window.innerWidth/4 +", "+ margin/2 +")");
;

    var width = + first.attr("width"),
        height = + first.attr("height"),
        o_inner_radius = 250,
        o_outer_radius = Math.min(width/2, height/2);

    var first = first.append("g")
                     .attr("transform", "translate("+ width/2 +", "+ height/2 +")");



   d3.csv("poke_type.csv", function(error, data){
      if(error) throw error;
      var types = data;
      types.forEach(function(d){
        for(var j in d){
          var num = +d[j];
          if(isNaN(num) == false){
            d[j] = num;
          }
        }
      });
      console.log(types)

      var o_band = d3.scaleBand()
                      .range([0, 2*Math.PI])
                      .domain(types.map(function(d){
                        return d.type;
                      }))
                      .align(0);

      var o_radial = d3.scaleRadial()
                       .range([o_inner_radius, o_outer_radius])
                       .domain([0, d3.max(types,function(d){
                         return d.num;
                       })]);

      var o_color = d3.scaleOrdinal()
                      .range(["#98abc5", "#7b6888"])
                      .domain(["num_pure", "num_npure"]);

      var stack = d3.stack()
                    .keys(["num_pure", "num_npure"]);

      console.log(stack(types));

      console.log(types.columns.slice(1,-24));

    first.append("g")
         .selectAll("g")
         .data(stack(types))
         .enter().append("g")
         .attr("fill", function(d){
           return o_color(d.key);
         })
         .selectAll("path")
         .data(function(d){
           return d;
         })
         .enter().append("path")
         .attr("d", d3.arc()
                      .innerRadius(function(d){
                        return o_radial(d[0]);
                      })
                      .outerRadius(function(d){
                        return o_radial(d[1]);
                      })
                      .startAngle(function(d){
                        return o_band(d.data.type);
                      })
                      .endAngle(function(d){
                        return o_band(d.data.type) + o_band.bandwidth();
                      })
                      .padAngle(0.01)
                      .padRadius(o_inner_radius)
               );


      var label = first.append("g")
                     .selectAll("g")
                     .data(types)
                     .enter().append("g")
                     .attr("text-anchor", "middle")
                     .attr("transform", function(d) { return "rotate(" + ((o_band(d.type) + o_band.bandwidth() / 2) * 180 / Math.PI - 90) + ")translate(" + o_inner_radius + ", 0)"; });

      label.append("line")
           .attr("x2", -5)
           .attr("stroke", "#fff");

      label.append("text")
           .attr("transform", function(d) { return (o_band(d.type) + o_band.bandwidth() / 2 + Math.PI / 2) % (2 * Math.PI) < Math.PI ? "rotate(90)translate(0,16)" : "rotate(-90)translate(0,-9)"; })
           .text(function(d) { return d.type; })
           .attr("fill", "#fff")
           .attr("font-size", "20px");

      var y_axis = first.append("g")
                      .attr("text-anchor", "end");

      var y_tick = y_axis.selectAll("g")
                         .data(o_radial.ticks(10).slice(1))
                         .enter().append("g");

      y_tick.append("circle")
            .attr("fill", "none")
            .attr("stroke", "#fff")
            .attr("stroke-opacity", "0.8")
            .attr("r", o_radial);

      y_tick.append("text")
            .text(o_radial.tickFormat(10, "s"))
            .attr("x", -6)
            .attr("y", function(d) { return -o_radial(d); })
            .attr("dy", "0.35em")
            .attr("fill", "none")
            .attr("stroke", "#fff")
            .attr("stroke-width", 2);

      first.selectAll("g")
           .on("mouseover", function(d){
              d3.select("path")
                .attr("fill", "#6b486b");
            })
            .on("mouseout", function(d){
              d3.select("path")
                .attr("fill", "#7b6888");
            })
  /*    y_tick.append("text")
            .attr("x", -6)
            .attr("y", function(d) { return -o_radial(d); })
            .attr("dy", "0.35em")
            .text(o_radial.tickFormat(10, "s"));

/*


       var legend = g.append("g")
         .selectAll("g")
         .data(data.columns.slice(1).reverse())
         .enter().append("g")
           .attr("transform", function(d, i) { return "translate(-40," + (i - (data.columns.length - 1) / 2) * 20 + ")"; });

       legend.append("rect")
           .attr("width", 18)
           .attr("height", 18)
           .attr("fill", z);

       legend.append("text")
           .attr("x", 24)
           .attr("y", 9)
           .attr("dy", "0.35em")
           .text(function(d) { return d; });     */

    })



    </script>

  </body>

</html>
