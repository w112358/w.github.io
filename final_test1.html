<!DocTYPE HTML>

<html>

  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="final-style.css">
    <script src="d3-scale-radial.js"></script>
    <script src="d3-tip.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Audiowide|Aladin|Yellowtail|Barlow+Condensed" rel="stylesheet">
    <title>Poke</title>

  </head>


  <body>

    <header>
      <ul>
        <li><a href = "https://w112358.github.io">Home</a></li>
        <li class = "dropdown">
          <a>Projects</a>
          <div class = "dropdown_content">
            <a href = "https://w112358.github.io/class2_HW2">Project 2</a>
            <a href = "https://w112358.github.io/class3_HW3">Project 3</a>
            <a href = "https://w112358.github.io/class4_HWK">Project 4</a>
        </li>
        <li class = "nav_left"><a href = "https://bulbapedia.bulbagarden.net/wiki/Main_Page">More</a></li>
      </ul>

    <div class = "title_loc"></div>
      <div class = "title">
        <div class = "title_text">Poke & data</div>
      </div>
    </header>

    <div id = "main" class = "main_content">
      <div class = "main_part">
        <div class = "main_title">Generations</div>

        <div class = "main_text">
          <p>
            All of the licensed Pokémon properties overseen by The Pokémon Company International
            are divided roughly by generation. These generations are roughly
            chronological divisions by release; every several years, when an
            official sequel in the main RPG series is released that features new Pokémon,
            characters, and gameplay concepts, that sequel is considered the start of a new
            generation of the franchise.
          </p>
        </div>

        <div class = "row">
          <div class = "column_side">
            <ul class = "gene_body">
              <li class = "gene_button" onclick = "g(1)"><span>G1 Red & Green</span></li>
              <li class = "gene_button" onclick = "g(2)"><span>G2 Gold & Silver</span></li>
              <li class = "gene_button" onclick = "g(3)"><span>G3 Ruby & Sapphire</span></li>
              <li class = "gene_button" onclick = "g(4)"><span>G4 Diamond & Pearl</span></li>
              <li class = "gene_button" onclick = "g(5)"><span>G5 Black & White</span></li>
              <li class = "gene_button" onclick = "g(6)"><span>G6 X & Y</span></li>
              <li class = "gene_button" onclick = "g(7)"><span>G7 Sun & Moon</span></li>
            </ul>
          </div>

          <div class = "column_middle">
              <svg id = "gene"></svg>

          </div>
        </div>
      </div>

      <div class = "main_space"></div>

      <div class = "main_part">
        <div class = "main_title">types</div>

        <div class = "main_text">
          <p>
            Types are properties for Pokémon and their moves. As of Generation
            VI, there are 18 types. Most of these were introduced during Generation I,
            but the Dark and Steel types were introduced in Generation II and the
            Fairy type was introduced in Generation VI.
          </p>
          <p>
            A move has exactly one type. The type of a damaging move typically
            defines which types of Pokémon it is super effective against, which
            types of Pokémon it is not very effective against, and which types
            of Pokémon it is completely ineffective against.
          </p>
        </div>

<!--
        <div class = "row">
          <div class = "column_side">
            <ul class = "type_body">
              <li class = "gene_button" onclick = ""><span>Distribution</span></li>
              <li class = "gene_button" onclick = ""><span>others</span></li>
            </ul>
          </div>

          <div class = "column_middle">
            <svg id = "type"></svg>

          </div>
        </div>
-->     <div class = "select_space"></div>
        <svg id = "type"></svg>

      </div>

      <div class = "main_space"></div>

      <div class = "main_part">
        <div class = "main_title">Pokedex</div>

        <div class = "main_text">
          <p>
            Every Pokémon creature has an array of stats.
            HP (Hit Points) is a Pokémon's life force. The Speed stat decides which
            Pokémon will make the first move in battle. Attack and Special Attack
            measure the strength of moves used by your Pokémon; the higher this is,
            the more damage you will do to opponents. Attack corresponds to moves in
            the Physical category, while Special Attack corresponds to Special moves.
            Similarly, Defense and Special Defense measure the ability to take attacks
            from other Pokémon; the higher the stat is, the fewer Hit Points will be
            lost when attacked. Defense correspnds to moves in the Physical category,
            while Special Defense corresponds to Special moves.
          </p>
        </div>

        <div class = "row">
          <div class = "column_side">

             <form name = "select_form" onSubmit = "return submit_click()">
              <label for = "select_name" class = "select_label">Name</label>
              <input type = "text" id = "select_name" placeholder = "name...">

              <label for = "select_type" class = "select_label">Type</label>
              <select id = "select_type">
                <option value = "none">none</option>
                <option value = "bug">bug</option>
                <option value = "dark">dark</option>
                <option value = "dragon">dragon</option>
                <option value = "electric">electric</option>
                <option value = "fairy">fairy</option>
                <option value = "fighting">fighting</option>
                <option value = "fire">fire</option>
                <option value = "flying">flying</option>
                <option value = "ghost">ghost</option>
                <option value = "grass">grass</option>
                <option value = "ground">ground</option>
                <option value = "ice">ice</option>
                <option value = "normal">normal</option>
                <option value = "poison">poison</option>
                <option value = "psychic">psychic</option>
                <option value = "rock">bug</option>
                <option value = "steel">steel</option>
                <option value = "water">water</option>
              </select>

              <label for = "requirement_detail" class = "select_label">Requirement</label>
                <select id = "requirement_detail">
                  <option value = "none">none</option>
                  <option value = "1">hp</option>
                  <option value = "2">attack</option>
                  <option value = "3">defense</option>
                  <option value = "4">sp_atk</option>
                  <option value = "5">sp_def</option>
                  <option value = "6">speed</option>
                </select>

            <label for = "reuirement_value" class = "select_label">Value : <span id = "requirement_valuetext">…</span>
            </label>
            <input type = "range" min = "0", max = "255" id = "requirement_value">

              <input type = "submit" value = "submit" class = "submit" id = "submit">
           </form>
          </div>

          <div class = "column_middle">

            <svg id = "selector"></svg>
          </div>
        </div>

      </div>

    </div>

    <div class = "footer_loc"></div>

    <footer>
      <div class= "footer_text">
        <p>Pokemon & Data</p>
      </div>
    </footer>
    <!--    <svg id="mysvg"></svg>   -->
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <script>


      var width = (window.innerWidth-500)*0.70;
      var height = 700;
      var gene = d3.select("#gene")
                   .attr("width", width)
                   .attr("height", height)
                   .attr("transform", "translate(0, 0)")
                   .append("g")
                   .attr("transform", "translate("+ width/2 +", "+ height/2 +")");



      function g(generation){

        d3.csv("poke_gene.csv", function(error, data){
          if(error) throw error;

          poke_gene = data;
          poke_gene.forEach(function(d){
            for(var j in d){
              var num = + d[j];
              if(isNaN(num) == false){
              d[j] = num;
              }
            }
          });

          var radius = Math.min(width/2, height/2);

          var pie = d3.pie()
                      .sort(null)
                      .value(function(d){

                        switch(generation){
                          case 1: return d.gene1; break;
                          case 2: return d.gene2; break;
                          case 3: return d.gene3; break;
                          case 4: return d.gene4; break;
                          case 5: return d.gene5; break;
                          case 6: return d.gene6; break;
                          case 7: return d.gene7; break;
                        }

                      });


          var arc = d3.arc()
                      .innerRadius(radius * 0.4)
                      .outerRadius(radius)
                      .padRadius(radius * 0.8)
                      .padAngle(0.05)
                      .cornerRadius(10);

          var color = d3.scaleOrdinal()
                        .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"])
                        .domain(["hp", "attack", "defense", "sp_attack", "sp_defense", "speed"]);



          var gene_shape = gene.selectAll(".arc")
                               .data(pie(poke_gene));

          var gene_enter = gene_shape.enter().append("g")
                                     .attr("class", "arc");

          gene_shape.exit().remove();

          gene_enter.append("path");

          gene_enter.append("text");

          gene_shape = gene_shape.merge(gene_enter);

          gene_shape.selectAll("path")
                    .data(d => [d])
                    .transition()
                    .duration(1800)

                    .attr("d", arc)
                    .style("fill", function(d){
                      return color(d.data.label);
                    });

          gene_shape.selectAll("text")
                    .data(d => [d])
                    .transition()
                    .duration(1800)
                    .attr("transform", function(d){
                      return "translate("+ arc.centroid(d) +")";
                    })
                    .attr("dy", ".35em")
                    .text(function(d){
                        var t;
                        switch(generation){
                          case 1: t = d.data.gene1; break;
                          case 2: t = d.data.gene2; break;
                          case 3: t = d.data.gene3; break;
                          case 4: t = d.data.gene4; break;
                          case 5: t = d.data.gene5; break;
                          case 6: t = d.data.gene6; break;
                          case 7: t = d.data.gene7; break;
                        }

                      return d.data.label + ":" + Math.round(t);
                    });


        });

    }

    g(1);

    </script>


    <script>

    var width = (window.innerWidth-500)*0.75;
    var height = 850;
    var tsvg = d3.select("#type")
                 .attr("width", width)
                 .attr("height", height)
                 .attr("transform", "translate("+ window.innerWidth*0.08 +", 0)");

    var o_inner_radius = Math.min(width/4, height/4);
    var o_outer_radius = Math.min(width/2, height/2);
    var i_outer_radius = o_inner_radius * 0.7;
    var i_inner_radius = i_outer_radius * 0.5;


    var tshape = tsvg.append("g")
                         .attr("transform", "translate("+ width/2 +", "+ height/2*1.015 +")");

    d3.csv("poke_type.csv", function(error, data){
      if(error) throw error;

      var types = data;
      types.forEach(function(d){
        for(var j in d){
          var num = +d[j];
          if(isNaN(num) == false){
            d[j] = num;
          }
        }
      });

      function column_to_row(d){
           return [{type: d.hp, label: "hp"},
                   {type: d.attack, label: "attack"},
                   {type: d.defense, label: "defense"},
                   {type: d.sp_atk, label: "sp_atk"},
                   {type: d.sp_def, label: "sp_def"},
                   {type: d.speed, label: "speed"}
                 ];
      };

      var o_band = d3.scaleBand()
                      .range([0, 2*Math.PI])
                      .domain(types.map(function(d){
                        return d.type;
                      }))
                      .align(0);

      var o_radial = d3.scaleRadial()
                       .range([o_inner_radius, o_outer_radius])
                       .domain([0, d3.max(types,function(d){
                         return d.num;
                       })]);

      var o_color = d3.scaleOrdinal()
                     .range(["#98abc5", "#7b6888"])
                     .domain(["num_pure", "num_npure"]);

      var stack = d3.stack()
                    .keys(["num_pure", "num_npure"]);

      var i_pie = d3.pie()
                    .sort(null)
                    .value(function(d){
                      return d.type;
                    });


      var i_arc = d3.arc()
                    .innerRadius(i_inner_radius)
                    .outerRadius(i_outer_radius)
                    .padRadius(i_outer_radius * 0.8)
                    .padAngle(0.05)
                    .cornerRadius(0);

      var i_color = d3.scaleOrdinal()
                    .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"])
                    .domain(["hp", "attack", "defense", "sp_atk", "sp_def", "speed"]);

      var tip = d3.tip()
                  .attr('class', 'd3-tip')
                  .offset([0, 0])
                  .html(function(d) {
                    return "one-type" + ": <span style='color:darkred'>" + d.data.num_pure + "</span>"+"<br>"+
                           "two-types" + ": <span style = 'color:darkred'>" + d.data.num_npure + "</span>";
                  });
      tshape.call(tip);

      tshape.append("g")
                    .selectAll("g")
                    .data(stack(types))
                    .enter().append("g")
                    .attr("fill", function(d){
                      return o_color(d.key);
                    })
                    .selectAll("path")
                    .data(function(d){
                      return d;
                    })
                    .enter().append("path")
                    .attr("d", d3.arc()
                                 .innerRadius(function(d){
                                   return o_radial(d[0]);
                                 })
                                 .outerRadius(function(d){
                                   return o_radial(d[1]);
                                 })
                                 .startAngle(function(d){
                                   return o_band(d.data.type);
                                 })
                                 .endAngle(function(d){
                                   return o_band(d.data.type) + o_band.bandwidth();
                                 })
                                 .padAngle(0.035)
                                 .padRadius(o_inner_radius)
                          )
                    .attr("class", "tshape")
                    .each(function(d, i){
                      d.order = i;
                    })
                    .on("mouseover", tip.show)
                    .on("mouseout", tip.hide)
                    .on("click", function(d){
                      var t1 = d.data.type;
                      console.log(d.data.type);
                      console.log(d.order);
                      draw_i_shape(d.order);
          /*           d3.selectAll("g")
                       .each(function(d){
                         console.log(d);
                       });
                       .attr("fill", function(d){
                          console.log(d.type);
                          console.log(t1);

                        })               */
                    });

      var label = tshape.append("g")
                        .selectAll("g")
                        .data(types)
                        .enter().append("g")
                        .attr("text-anchor", "middle")
                        .attr("transform", function(d) { return "rotate(" + ((o_band(d.type) + o_band.bandwidth() / 2) * 180 / Math.PI - 90) + ")translate(" + o_inner_radius + ", 0)"; });

      label.append("line")
           .attr("x2", -5)
           .attr("stroke", "#fff");

      label.append("text")
           .attr("transform", function(d) { return (o_band(d.type) + o_band.bandwidth() / 2 + Math.PI / 2) % (2 * Math.PI) < Math.PI ? "rotate(90)translate(0,16)" : "rotate(-90)translate(0,-9)"; })
           .text(function(d) { return d.type; })
           .attr("fill", "#fff")
           .attr("font-family", "Barlow Condensed")
           .attr("font-size", "20px");

      var y_axis = tshape.append("g")
                         .attr("text-anchor", "end");

      var y_tick = y_axis.selectAll("g")
                         .data(o_radial.ticks(6).slice(1))
                         .enter().append("g");

      y_tick.append("circle")
            .attr("fill", "none")
            .attr("stroke", "#fff")
            .attr("stroke-opacity", "0.8")
            .attr("r", o_radial)
            .attr("opacity", 0.8);

      y_tick.append("text")
            .text(o_radial.tickFormat(10, "s"))
            .attr("font-family", "Barlow Condensed")
            .attr("x", 10)
            .attr("y", function(d) { return -o_radial(d); })
            .attr("dy", "0.25em")
            .attr("fill", "none")
            .attr("stroke", "#fff")
            .attr("stroke-width", 1.5)
            .attr("opacity", 0.8);

      var legend = tshape.append("g")
                         .attr("class", "legend")
                         .selectAll("g")
                         .data(types.columns.slice(1, -26).reverse())
                         .enter().append("g")
                         .attr("transform", function(d, i) { return "translate(0," + i * 24 + ")"; });

      legend.append("rect")
            .attr("x", 30)
            .attr("y", -30)
            .attr("width", 20)
            .attr("height", 20)
            .attr("fill", o_color);

      legend.append("text")
            .attr("x", 12)
            .attr("y", -20)
            .attr("dy", "0.32em")
            .text(function(d) { return d; })
            .attr("font-size", "20px");

     function draw_i_shape(key){
          var i_shape =  tshape.selectAll(".i_arc")
                               .data(i_pie(column_to_row(types[key])));

          var i_shape_enter = i_shape.enter().append("g")
                                     .attr("class", "i_arc");

          i_shape.exit().remove();

          i_shape_enter.append("path");

          i_shape_enter.append("text");

          i_shape = i_shape.merge(i_shape_enter);

          i_shape.selectAll("path")
                 .data(d => [d])
                 .transition()
                 .duration(2000)
                 .attr("d", i_arc)
                 .style("fill", function(d){
                   return i_color(d.data.label);
                 });

          i_shape.selectAll("text")
                 .data(d => [d])
                 .transition()
                 .duration(2000)
                 .attr("transform", function(d){
                   return "translate("+ i_arc.centroid(d) +")"
                 })
                 .attr("dy", ".35em")
                 .text(function(d){
                   return d.data.label + ":" + Math.round(d.data.type);
                 });
       };

    });



    </script>

    <script>

    var width = (window.innerWidth - 500) * 0.70;
    var height = 500;
    var rect_width = width - 100;
    var rect_height = height - 50;
    var selector = d3.select("#selector")
                     .attr("width", width)
                     .attr("height", height)
                //     .style("background-color", "grey")
                     .attr("transform", "translate(50, " + window.innerWidth * 0.05 + ")");

    var rect_selector = selector.append("g")
                                .attr("transform", "translate(40,20)");

/*
    d3.select("#submit")
      .on("click", function(d){
        console.log("hehe");
      });
*/

    d3.select("#requirement_value")
      .on("input", function(){
        requirement_value_update(this.value);
      });
    requirement_value_update(0);
    function requirement_value_update(requirement_v){
      d3.select("#requirement_valuetext").text(requirement_v);
      d3.select("#requirement_value").property("value", requirement_v);
    };

    function submit_click(){
      var t1 = d3.select("#select_name").node().value;
      t1 = t1.toLowerCase();
      var t2 = d3.select("#select_type").node().value;
      var t3 = d3.select("#requirement_detail").node().value;
      var t4 = d3.select("#requirement_value").node().value;

      select_draw(t1, t2, t3, t4);

      return false;
    };



    function select_draw(input_name, input_type, input_requirement, input_requirement_value){

    d3.csv("poke_select.csv", function(error, d){
      if(error) throw error;

      var poke_select = d;
      poke_select.forEach(function(d){
        var num;
        for(var j in d){
          num = + d[j];
          if(isNaN(num) == false){
            d[j] = num;
          }
        }
      });

      var keys = poke_select.columns.slice(4);

      var s = poke_select.filter(function(d){
                if(d.name.toLowerCase() == input_name){
                  return d;
                }
                else if(input_type != "none" && input_requirement != "none"){
                  var t_or_f;
                  var distance = 5;
                  switch(input_requirement, distance){
                    case 1: t_or_f = Math.abs(d.hp - input_requirement_value) < distance; break;
                    case 2: t_or_f = Math.abs(d.attack - input_requirement_value) < distance; break;
                    case 3: t_or_f = Math.abs(d.defense - input_requirement_value) < distance; break;
                    case 4: t_or_f = Math.abs(d.sp_attack - input_requirement_value) < distance; break;
                    case 5: t_or_f = Math.abs(d.sp_defense - input_requirement_value) < distance; break;
                    case 6: t_or_f = Math.abs(d.speed - input_requirement_value) < distance; break;
                  };

  /*                console.log(d.name);
                  console.log(input_requirement);
                  console.log(t_or_f);
                  console.log(Math.abs(d.attack - input_requirement_value) < distance);
                  console.log((d.type1 == input_type || d.type2 == input_type));
                  console.log((d.type1 == input_type || d.type2 == input_type)&& t_or_f);
*/
                  if((d.type1 == input_type || d.type2 == input_type) && t_or_f){
                    return d;
                  };
                }
                else {
                  return error;

                }
              });
      console.log(s);

      var x_axis0 = d3.scaleBand()
                      .rangeRound([0, rect_width])
                      .domain(s.map(function(d){
                        return d.name;
                      }))
                      .paddingInner(0.1);

      var x_axis1 = d3.scaleBand()
                      .rangeRound([20, x_axis0.bandwidth()])
                      .domain(keys)
                      .padding(0.05);

      var y_axis = d3.scaleLinear()
                     .rangeRound([rect_height, 0])
                     .domain([0, d3.max(s, function(d){
                       return d3.max(keys, function(j){return d[j];})
                     })])
                     .nice();

      var rect_color = d3.scaleOrdinal()
                         .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"])
                         .domain(keys);

      var rect_groups = rect_selector.selectAll("g.bar")
                                     .data(s);



       var rect_groups_enter = rect_groups.enter().append("g")
                                          .attr("class", "bar");

      rect_groups.exit().remove();

      rect_groups = rect_groups.merge(rect_groups_enter)

      rect_groups.transition()
                 .duration(1000)
                 .attr("transform", function(d){
                   return "translate("+ x_axis0(d.name) +", 0)";
                 });


      var rect_shapes = rect_groups.selectAll("rect")
                                   .data(function(d){
                                     return keys.map(function(j){
                                       console.log({key:j, value:d[j]});
                                       return {key:j, value:d[j]};
                                     });
                                   });

      var rect_enters = rect_shapes.enter().append("rect");

      rect_shapes = rect_shapes.merge(rect_enters);

      rect_shapes.transition()
                 .duration(1000)
                 .attr("x", function(d){
                  return x_axis1(d.key);
                })
                .attr("y", function(d){
                  return y_axis(d.value);
                })
                .attr("width", x_axis1.bandwidth())
                .attr("height", function(d){
                  return rect_height - y_axis(d.value);
                })
                .attr("fill", function(d){

                  return rect_color(d.key);
                });

      rect_shapes.exit().remove();


      var rect_axis = rect_selector.selectAll("g.axis")
                                   .data(function(d){return d;})
                                   .each(function(d){console.log(d);});

      var rect_axis_enter = rect_axis.enter().append("g")
                                             .attr("class", "axis");

      rect_axis.exit().remove();

      rect_axis_enter.append("g");

      rect_axis_enter.append("text");

      rect_axis = rect_axis.merge(rect_axis_enter);

      rect_axis.selectAll("g")
                   .data(d => [d])
                   .attr("class", "axis")
                   .attr("transform", "translate(0, "+ rect_height +")")
                   .call(d3.axisBottom(x_axis0));

      rect_axis.selectAll("text")
                   .data(d => [d])
                   .attr("class", "axis")
                   .call(d3.axisLeft(y_axis).ticks(null, "s"))
                   .append("text")
                   .attr("x", 2)
                   .attr("y", y_axis(y_axis.ticks().pop()) + 0.5)
                   .attr("dy", "0.32em")
                   .text("value");


      var legend = rect_selector.append("g")
                                .attr("class", "legend")
                                .selectAll("g")
                                .data(keys.slice().reverse())
                                .enter().append("g")
                                .attr("transform", function(d, i) { return "translate(0," + i * 17 + ")"; });

      legend.append("rect")
            .attr("x", width - 100)
            .attr("width", 15)
            .attr("height", 15)
            .attr("fill", rect_color);

      legend.append("text")
            .attr("x", width - 115)
            .attr("y", 9.5)
            .attr("dy", "0.32em")
            .text(function(d) { return d; });

    });

  };


    </script>

  </body>

</html>
